<div class="container-fluid py-4 bg-light">

  <div class="row g-4">

    <!-- COLUNA DA ESQUERDA: FILTROS -->
    <div class="col-lg-3 d-flex flex-column gap-3">

      <!-- GRUPO 1: DEFINI√á√ÉO DA AMOSTRA -->
      <div class="card shadow-sm border-0">
        <div class="card-header bg-white border-0 pt-3 pb-0">
          <div class="d-flex align-items-center text-primary mb-1">
            <i class="bi bi-people-fill me-2 fs-5"></i>
            <h6 class="fw-bold mb-0">Base da Amostra</h6>
          </div>
          <p class="text-muted small mb-0 lh-sm" style="font-size: 0.8rem;">
            Filtra a quantidade de profissionais (N) encontrados na base RAIS.
          </p>
        </div>

        <div class="card-body">
          <div class="mb-3">
            <label class="form-label fw-bold text-secondary small">Cargo / Ocupa√ß√£o</label>
            <input class="form-control" list="listaCargosMap" [(ngModel)]="cargoSelecionado" placeholder="Digite o cargo...">
            <datalist id="listaCargosMap">
              @for (c of listaCargos; track c) { <option [value]="c"></option> }
            </datalist>
          </div>

          <div class="mb-0">
            <label class="form-label fw-bold text-secondary small">Ano de Refer√™ncia</label>
            <select class="form-select" [(ngModel)]="anoSelecionado">
              @for (ano of anosDisponiveis; track ano) { <option [value]="ano">{{ ano }}</option> }
            </select>
          </div>
        </div>
      </div>

      <!-- GRUPO 2: PAR√ÇMETROS DA ESTIMATIVA -->
      <div class="card shadow-sm border-0 flex-grow-1">
        <div class="card-header bg-white border-0 pt-3 pb-0">
          <div class="d-flex align-items-center text-success mb-1">
            <i class="bi bi-cpu-fill me-2 fs-5"></i>
            <h6 class="fw-bold mb-0">Estimativa Salarial (IA)</h6>
          </div>
          <p class="text-muted small mb-0 lh-sm" style="font-size: 0.8rem;">
            Define o perfil para o modelo de Machine Learning calcular o sal√°rio.
          </p>
          <p class="text-muted small mb-0 lh-sm" style="font-size: 0.8rem;">
            Obs.: Para o c√°lculo do sal√°rio m√©dio, assumimos por padr√£o pessoa do sexo masculino da ra√ßa/cor branca
          </p>
        </div>

        <div class="card-body">
          <div class="mb-3">
            <label class="form-label fw-bold small text-muted">Setor de Atua√ß√£o</label>
            <select class="form-select" [(ngModel)]="setorSelecionado" name="setor">
              <option [ngValue]="null" disabled selected>Selecione o setor...</option>

              @for (item of setoresOpcoes; track item.value) {
                <option [value]="item.value">{{ item.label }}</option>
              }
            </select>
          </div>

          <div class="mb-3">
            <label class="form-label fw-bold text-secondary small">Porte da Empresa</label>
            <select class="form-select" [(ngModel)]="tamanhoEmpresaSelecionado">
              <option value="Zero funcion√°rios">Zero funcion√°rios</option>
              <option value="De 1 a 4 funcion√°rios">De 1 a 4 funcion√°rios</option>
              <option value="De 5 a 9 funcion√°rios">De 5 a 9 funcion√°rios</option>
              <option value="De 10 a 19 funcion√°rios">De 10 a 19 funcion√°rios</option>
              <option value="De 20 a 49 funcion√°rios">De 20 a 49 funcion√°rios</option>
              <option value="De 50 a 99 funcion√°rios">De 50 a 99 funcion√°rios</option>
              <option value="De 100 a 249 funcion√°rios">De 100 a 249 funcion√°rios"</option>
              <option value="De 250 a 499 funcion√°rios">De 250 a 499 funcion√°rios</option>
              <option value="De 500 a 999 funcion√°rios">De 500 a 999 funcion√°rios</option>
              <option value="1000 ou mais funcion√°rios">1000 ou mais funcion√°rios+</option>
            </select>
          </div>

          <div class="mb-3">
            <label class="form-label fw-bold text-secondary small">Escolaridade</label>
            <select class="form-select" [(ngModel)]="escolaridadeSelecionada">
              <option value="M√©dio Completo">M√©dio Completo</option>
              <option value="Superior Incompleto">Superior Incompleto</option>
              <option value="Superior Completo">Superior Completo</option>
              <option value="Mestrado">Mestrado</option>
              <option value="Doutorado">Doutorado</option>
            </select>
          </div>

          <div class="mb-3">
            <label class="form-label fw-bold text-secondary small">Senioridade</label>
            <select class="form-select" [(ngModel)]="faixaSelecionada">
              <option value="">üõ†Ô∏è Personalizar</option>
              @for (op of opcoesExperiencia; track op.value) {
                <option [value]="op.value">{{ op.label }}</option>
              }
            </select>
          </div>

          @if (!faixaSelecionada) {
            <div class="mb-4 animate__animated animate__fadeIn">
              <label class="form-label fw-bold text-secondary small">Idade Manual: {{ idadeManual }} anos</label>
              <input type="range" class="form-range" min="18" max="65" [(ngModel)]="idadeManual">
            </div>
          }

          <div class="d-grid mt-4">
            <button class="btn btn-primary py-2 fw-bold shadow-sm" (click)="atualizarDadosMapa()" [disabled]="carregando">
              @if (carregando) {
                <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                Processando...
              } @else {
                <i class="bi bi-search me-2"></i> Atualizar Mapa
              }
            </button>
          </div>

        </div>
      </div>
    </div>

    <!-- COLUNA DA DIREITA: MAPA -->
    <div class="col-lg-9">
      <div class="card shadow border-0 h-100" style="min-height: 750px;">
        <div class="card-body p-0 position-relative rounded overflow-hidden">

          <h5 class="position-absolute top-0 start-0 m-3 text-secondary fw-bold" style="z-index: 5;">
            <i class="bi bi-geo-alt-fill text-danger"></i> Mapa Salarial Nacional
          </h5>

          @if (carregando) {
            <div class="position-absolute top-0 start-0 w-100 h-100 bg-white bg-opacity-90 d-flex flex-column justify-content-center align-items-center" style="z-index: 10;">
              <div class="spinner-border text-primary mb-3" role="status" style="width: 3rem; height: 3rem;"></div>
              <h5 class="text-muted fw-bold">Consultando Intelig√™ncia Artificial...</h5>
              <small class="text-secondary">Processando dados dos 27 estados</small>
            </div>
          }

          @if (erro) {
            <div class="d-flex h-100 align-items-center justify-content-center">
              <div class="alert alert-danger m-5 shadow-sm text-center">
                <i class="bi bi-exclamation-triangle-fill fs-3 d-block mb-2"></i>
                {{ erro }}
              </div>
            </div>
          }

          @if (chartOptions && !erro) {
            <highcharts-chart
              [Highcharts]="Highcharts"
              [options]="chartOptions"
              [constructorType]="'mapChart'"
              style="width: 100%; height: 100%; display: block; min-height: 750px;">
            </highcharts-chart>
          }
        </div>
      </div>
    </div>

  </div>
</div>
