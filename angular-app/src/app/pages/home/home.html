<div class="container-fluid py-5 animate__animated animate__fadeIn">
  <div class="row justify-content-center">
    <div class="col-xl-11 col-xxl-10"> <!-- Aumentado para ocupar mais espa√ßo horizontal -->

      <div class="row g-4">

        <!-- COLUNA ESQUERDA: FORMUL√ÅRIO -->
        <div class="col-lg-5 col-xl-4">
          <div class="card main-card shadow-lg border-0 h-100">
            <div class="card-body p-4">

              <div class="text-center mb-4">
                <h3 class="fw-bold" style="color: var(--puc-blue)">Estimativa Salarial</h3>
                <p class="text-muted small">Preencha os dados para consultar a IA.</p>
              </div>

              <form (ngSubmit)="calcular()" #formSalario="ngForm">

                <div class="mb-3">
                  <label for="cargoInput" class="form-label fw-bold small text-muted">Cargo / Ocupa√ß√£o</label>
                  <input
                    type="text"
                    class="form-control bg-light"
                    id="cargoInput"
                    name="cargo"
                    [(ngModel)]="dados.cargo"
                    list="datalist-cargos"
                    placeholder="Busque o cargo..."
                    autocomplete="on"
                    required>

                  <datalist id="datalist-cargos">
                    @for (opcao of listaOpcoesVisual; track opcao) {
                      <option [value]="opcao"></option>
                    }
                  </datalist>
                </div>

                <div class="row g-3">
                  <div class="col-12">
                    <label class="form-label fw-bold small text-muted">Setor de Atua√ß√£o</label>
                    <select class="form-select" [(ngModel)]="dados.setor" name="setor">
                      <option [ngValue]="null" disabled selected>Selecione o setor...</option>

                      @for (item of setoresOpcoes; track item.value) {
                        <option [value]="item.value">{{ item.label }}</option>
                      }
                    </select>
                  </div>

                  <div class="col-12">
                    <label class="form-label fw-bold small text-muted">Porte da Empresa</label>
                    <select class="form-select" [(ngModel)]="dados.tamanho_empresa" name="tamanho">
                      <option value="Zero funcion√°rios">Zero funcion√°rios</option>
                      <option value="De 1 a 4 funcion√°rios">De 1 a 4 funcion√°rios</option>
                      <option value="De 5 a 9 funcion√°rios">De 5 a 9 funcion√°rios</option>
                      <option value="De 10 a 19 funcion√°rios">De 10 a 19 funcion√°rios</option>
                      <option value="De 20 a 49 funcion√°rios">De 20 a 49 funcion√°rios</option>
                      <option value="De 50 a 99 funcion√°rios">De 50 a 99 funcion√°rios</option>
                      <option value="De 100 a 249 funcion√°rios">De 100 a 249 funcion√°rios</option>
                      <option value="De 250 a 499 funcion√°rios">De 250 a 499 funcion√°rios</option>
                      <option value="De 500 a 999 funcion√°rios">De 500 a 999 funcion√°rios</option>
                      <option value="1000 ou mais funcion√°rios">1000 ou mais funcion√°rios</option>
                    </select>
                  </div>

                  <div class="col-md-6">
                    <label class="form-label fw-bold small text-muted">Senioridade</label>
                    <select class="form-select bg-light border-primary border-opacity-25"
                            [(ngModel)]="senioridadeSelecionada" name="senioridade">
                      <option value="">üõ†Ô∏è Manual</option>
                      @for (exp of listaExperiencias; track exp.value) {
                        <option [value]="exp.value">{{ exp.label }}</option>
                      }
                    </select>
                  </div>

                  <div class="col-md-6">
                    @if (!senioridadeSelecionada) {
                      <div class="animate__animated animate__fadeIn">
                        <label class="form-label fw-bold small text-muted">Idade</label>
                        <input type="number" class="form-control" [(ngModel)]="dados.idade" name="idade" min="16" max="70" required #idadeInput="ngModel">
                      </div>
                    } @else {
                      <label class="form-label fw-bold small text-muted opacity-50">Idade</label>
                      <input type="text" class="form-control" disabled value="Autom√°tico">
                    }
                  </div>

                  <div class="col-12">
                    <label class="form-label fw-bold small text-muted">Escolaridade</label>
                    <select class="form-select" [(ngModel)]="dados.escolaridade" name="escolaridade">
                      <option value="M√©dio Completo">M√©dio Completo</option>
                      <option value="Superior Incompleto">Superior Incompleto</option>
                      <option value="Superior Completo">Superior Completo</option>
                      <option value="Mestrado">Mestrado</option>
                      <option value="Doutorado">Doutorado</option>
                    </select>
                  </div>

                  <div class="col-6">
                    <label class="form-label fw-bold small text-muted">Sexo</label>
                    <select class="form-select" [(ngModel)]="dados.sexo" name="sexo">
                      <option value="Masculino">Masculino</option>
                      <option value="Feminino">Feminino</option>
                    </select>
                  </div>

                  <div class="col-6">
                    <label class="form-label fw-bold small text-muted">Ra√ßa/Cor</label>
                    <select class="form-select" [(ngModel)]="dados.raca" name="raca">
                      <option value="Branca">Branca</option>
                      <option value="Preta">Preta</option>
                      <option value="Parda">Parda</option>
                      <option value="Amarela">Amarela</option>
                      <option value="Ind√≠gena">Ind√≠gena</option>
                      <option value="N√£o Informado">N√£o Informado</option>
                    </select>
                  </div>

                  <div class="col-6">
                    <label class="form-label fw-bold small text-muted">UF</label>
                    <select class="form-select" [(ngModel)]="dados.uf" name="uf">
                      @for (uf of listaUfs; track uf) { <option [value]="uf">{{ uf }}</option> }
                    </select>
                  </div>

                  <div class="col-6">
                    <label class="form-label fw-bold small text-muted">Ano Ref.</label>
                    <select class="form-select" [(ngModel)]="dados.ano_referencia" name="ano">
                      @for (ano of listaAnos; track ano) { <option [value]="ano">{{ ano }}</option> }
                    </select>
                  </div>
                </div>

                <div class="mt-4 pt-2">
                  <button type="submit" class="btn btn-primary w-100 py-2 fw-bold shadow-sm"
                          [disabled]="carregando || formSalario.invalid"
                          style="background-color: var(--puc-blue); border: none;">
                    @if (carregando) {
                      <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                      Processando...
                    } @else {
                      <i class="bi bi-cpu me-2"></i> Calcular
                    }
                  </button>
                </div>

              </form>
            </div>
          </div>
        </div>

        <!-- COLUNA DIREITA: RESULTADO (OU PLACEHOLDER) -->
        <div class="col-lg-7 col-xl-8">
          <div class="card border-0 shadow-lg h-100 bg-light position-relative overflow-hidden">

            <!-- FUNDO DECORATIVO QUANDO N√ÉO H√Å RESULTADO -->
            @if (!resultado && !carregando && !erro) {
              <div class="d-flex flex-column align-items-center justify-content-center h-100 text-center p-5 opacity-50">
                <i class="bi bi-bar-chart-line text-secondary" style="font-size: 8rem;"></i>
                <h3 class="mt-4 text-muted fw-bold">Aguardando Dados</h3>
                <p class="text-secondary" style="max-width: 400px;">
                  Preencha o formul√°rio ao lado e clique em "Calcular" para ver a estimativa salarial detalhada aqui.
                </p>
              </div>
            }

            <!-- LOADING STATE -->
            @if (carregando) {
              <div class="d-flex flex-column align-items-center justify-content-center h-100 text-center p-5">
                <div class="spinner-grow text-primary mb-4" style="width: 4rem; height: 4rem;" role="status"></div>
                <h4 class="text-primary fw-bold animate__animated animate__pulse animate__infinite">Analisando Mercado...</h4>
                <p class="text-muted">Consultando milh√µes de registros da RAIS</p>
              </div>
            }

            <!-- RESULTADO -->
            @if (resultado) {
              <div class="animate__animated animate__fadeIn h-100 d-flex flex-column">
                <div class="card-header bg-gradient text-white p-4" style="background: var(--puc-blue);">
                  <div class="d-flex justify-content-between align-items-center">
                    <h4 class="mb-0 fw-bold"><i class="bi bi-robot me-2"></i> An√°lise Conclu√≠da</h4>
                  </div>
                </div>

                <div class="card-body p-5 text-center d-flex flex-column justify-content-center align-items-center flex-grow-1">

                  <h4 class="text-uppercase text-secondary fw-bold ls-1 mb-4">
                    {{ resultado.cargo }}
                  </h4>

                  <div class="d-flex justify-content-center gap-2 mb-5 flex-wrap">
                    <span class="badge bg-white text-dark border shadow-sm p-2">
                      <i class="bi bi-building me-1"></i> {{ resultado.resultado.detalhesPerfil.porteEmpresa }}
                    </span>
                    <span class="badge bg-white text-dark border shadow-sm p-2">
                      <i class="bi bi-mortarboard me-1"></i> {{ resultado.resultado.detalhesPerfil.escolaridade }}
                    </span>
                    @if (resultado.resultado.detalhesPerfil.nivelExperiencia) {
                      <span class="badge bg-info text-dark border shadow-sm p-2">
                        <i class="bi bi-star-fill me-1"></i> {{ resultado.resultado.detalhesPerfil.nivelExperiencia }}
                      </span>
                    }
                    <!-- ADICIONADO BADGE DE RA√áA -->
                    @if (resultado.resultado.detalhesPerfil.raca) {
                      <span class="badge bg-secondary text-white border shadow-sm p-2">
                        <i class="bi bi-person-badge me-1"></i> {{ resultado.resultado.detalhesPerfil.raca }}
                      </span>
                    }
                  </div>

                  <div class="py-2 mb-4 w-100">
                    <h1 class="display-1 fw-bold text-success mb-2">
                      {{ resultado.resultado.salario_corrigido }}
                    </h1>
                    <p class="text-muted small text-uppercase fw-bold">M√©dia de Mercado Ajustada (2025)</p>

                    <div class="d-inline-flex align-items-center bg-white border rounded-pill px-4 py-2 shadow-sm mt-2">
                      <small class="text-muted me-2">
                        Base Hist√≥rica: <strong>R$ {{ resultado.resultado.salario_estimado | number:'1.2-2' }}</strong>
                      </small>
                      <i class="bi bi-arrow-right-short text-primary mx-1"></i>
                      <span class="badge bg-primary bg-opacity-10 text-primary border border-primary border-opacity-25">
                        IPCA {{ resultado.resultado.fator_correcao }}x
                      </span>
                    </div>
                  </div>

                  <div class="row justify-content-center w-100">
                    <div class="col-md-10">
                      <div class="alert alert-secondary bg-white border shadow-sm rounded-4 p-4">
                        <h6 class="text-muted fw-bold text-uppercase small mb-3">
                          <i class="bi bi-arrows-expand me-1"></i> Faixa de Negocia√ß√£o Prov√°vel
                        </h6>
                        <div class="d-flex justify-content-between align-items-center px-md-5">
                          <div class="text-center">
                            <span class="d-block text-secondary small fw-bold mb-1">M√≠nimo</span>
                            <span class="h3 fw-bold text-dark mb-0">{{ resultado.resultado.salarioMinFormatado }}</span>
                          </div>
                          <div class="text-muted opacity-25"><i class="bi bi-arrow-left-right fs-2"></i></div>
                          <div class="text-center">
                            <span class="d-block text-secondary small fw-bold mb-1">M√°ximo</span>
                            <span class="h3 fw-bold text-dark mb-0">{{ resultado.resultado.salarioMaxFormatado }}</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                </div>
              </div>
            }

            <!-- ERRO -->
            @if (erro) {
              <div class="d-flex flex-column align-items-center justify-content-center h-100 text-center p-5">
                <div class="alert alert-danger shadow-sm animate__animated animate__shakeX" role="alert">
                  <i class="bi bi-exclamation-triangle-fill me-2 fs-4"></i>
                  <strong>Ops!</strong> {{ erro }}
                </div>
              </div>
            }

          </div>
        </div>

      </div>
    </div>
  </div>
</div>
